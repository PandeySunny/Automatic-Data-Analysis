<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Analysis Results â€¢ Data Analyzer Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Comprehensive data analysis results with AI-powered insights and visualizations.">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 2rem;">
      <h1>ğŸ“Š Analysis Results</h1>
      <p style="font-size: 1.125rem; color: var(--text-secondary); margin-bottom: 0;">
        Comprehensive insights from your data with AI-powered analytics
      </p>
    </div>

    <!-- File Info Card -->
    <div class="meta" style="border-left: 4px solid var(--primary);">
      <p style="margin: 0; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
        <span style="font-size: 1.25rem;">ğŸ“„</span>
        <strong>File:</strong>
        <code style="background: rgba(99, 102, 241, 0.1); padding: 4px 8px; border-radius: 4px;">{{ filename }}</code>
      </p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Rows</h3>
        <div class="value" data-count="{{ rows }}">{{ rows }}</div>
      </div>
      <div class="stat-card">
        <h3>Total Columns</h3>
        <div class="value" data-count="{{ cols }}">{{ cols }}</div>
      </div>
      {% if ml_results %}
      <div class="stat-card">
        <h3>Segments Found</h3>
        <div class="value">{{ ml_results.segment_profiles|length if ml_results.segment_profiles else 4 }}</div>
      </div>
      <div class="stat-card">
        <h3>Data Quality</h3>
        <div class="value" style="font-size: 1.5rem;">
          {{ "âœ… Clean" if summary_source == "full file" else "âš ï¸ Sample" }}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Dataset Overview & Explanation -->
    {% if dataset_explanation %}
    <div style="margin: 3rem 0;">
      <h2>ğŸ“– Dataset Overview & Explanation</h2>

      <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        <div
          style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--primary);">
          <p style="margin: 0 0 0.5rem 0; color: var(--text-secondary); font-size: 0.875rem;">Total Rows</p>
          <p style="margin: 0; font-size: 1.75rem; font-weight: bold; color: var(--primary);">{{
            dataset_explanation.total_rows }}</p>
        </div>

        <div
          style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #8b5cf6;">
          <p style="margin: 0 0 0.5rem 0; color: var(--text-secondary); font-size: 0.875rem;">Total Columns</p>
          <p style="margin: 0; font-size: 1.75rem; font-weight: bold; color: #8b5cf6;">{{ dataset_explanation.total_cols
            }}</p>
        </div>

        <div
          style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #22c55e;">
          <p style="margin: 0 0 0.5rem 0; color: var(--text-secondary); font-size: 0.875rem;">Data Completeness</p>
          <p style="margin: 0; font-size: 1.75rem; font-weight: bold; color: #22c55e;">{{
            dataset_explanation.completeness_percent }}%</p>
        </div>

        <div
          style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #ef4444;">
          <p style="margin: 0 0 0.5rem 0; color: var(--text-secondary); font-size: 0.875rem;">Data Quality</p>
          <p style="margin: 0; font-size: 1.75rem; font-weight: bold; color: #ef4444;">{{
            dataset_explanation.quality_status }}</p>
        </div>
      </div>

      <div
        style="background: rgba(59, 130, 246, 0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--primary); margin-bottom: 2rem;">
        <h3 style="margin-top: 0;">ğŸ“Š What This Data Contains</h3>
        <p style="margin-bottom: 1rem;">
          <strong>Dataset:</strong> {{ dataset_explanation.filename }}<br>
          <strong>Source Type:</strong> {{ dataset_explanation.summary_source|title }}<br>
          <strong>File Size:</strong> {{ dataset_explanation.memory_mb }} MB
        </p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
          <div>
            <h4 style="margin-top: 0; color: var(--primary);">Numeric Variables ({{ dataset_explanation.numeric_cols }})
            </h4>
            <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.875rem;">
              Variables with numerical values suitable for statistical analysis and machine learning:
            </p>
            <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary);">
              {% for col in dataset_explanation.numeric_columns[:8] %}
              <li style="margin: 0.25rem 0; font-size: 0.875rem;">{{ col }}</li>
              {% endfor %}
              {% if dataset_explanation.numeric_columns|length > 8 %}
              <li style="margin: 0.25rem 0; font-size: 0.875rem; color: var(--text-muted);">+{{
                dataset_explanation.numeric_columns|length - 8 }} more</li>
              {% endif %}
            </ul>
          </div>
          <div>
            <h4 style="margin-top: 0; color: #8b5cf6;">Categorical Variables ({{ dataset_explanation.categorical_cols
              }})</h4>
            <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.875rem;">
              Variables with categorical values like names, types, and classifications:
            </p>
            <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary);">
              {% for col in dataset_explanation.categorical_columns[:8] %}
              <li style="margin: 0.25rem 0; font-size: 0.875rem;">{{ col }}</li>
              {% endfor %}
              {% if dataset_explanation.categorical_columns|length > 8 %}
              <li style="margin: 0.25rem 0; font-size: 0.875rem; color: var(--text-muted);">+{{
                dataset_explanation.categorical_columns|length - 8 }} more</li>
              {% endif %}
            </ul>
          </div>
        </div>
        {% if dataset_explanation.duplicate_rows > 0 %}
        <p
          style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; color: #dc2626;">
          <strong>âš ï¸ Note:</strong> Found {{ dataset_explanation.duplicate_rows }} duplicate row(s) that were removed
          during analysis for accuracy.
        </p>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Dataset Summary -->
    <div style="margin: 3rem 0;">
      <h2>ğŸ“‹ Dataset Summary</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        Statistical overview of all columns in your dataset
        {% if summary_source != "full file" %}
        <span style="color: #f59e0b; font-weight: 600;">(based on {{ summary_source }})</span>
        {% endif %}
      </p>
      <div class="table-wrapper">
        {{ summary_html | safe }}
      </div>
    </div>

    <!-- Sample Rows -->
    <div style="margin: 3rem 0;">
      <h2>ğŸ” Sample Data Preview</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        First 10 rows of your dataset
      </p>
      <div class="table-wrapper">
        {{ head | safe }}
      </div>
    </div>

    <!-- Visualizations -->
    <div style="margin: 3rem 0;">
      <h2>ğŸ“Š Data Visualizations</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
        Explore your data through charts and graphs
      </p>

      {% if plots %}
      <div class="plots-grid">
        {% for p in plots %}
        <div class="plot-card">
          <img src="{{ url_for('static', filename=p.split('static/')[1]) }}" alt="Data visualization" loading="lazy"
            style="width: 100%; height: auto;" />
        </div>
        {% endfor %}
      </div>

      <div
        style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1)); border-radius: 12px; border-left: 4px solid #22c55e;">
        <h3 style="margin-top: 0; color: #22c55e;">âœ… Analysis Complete</h3>
        <p style="margin: 0; color: var(--text-secondary);">
          The charts above show different aspects of your data including distributions, relationships, and patterns.
        </p>
      </div>
      {% else %}
      <div
        style="text-align: center; padding: 3rem; background: rgba(99, 102, 241, 0.05); border-radius: 12px; border: 1px dashed var(--primary-light);">
        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“ˆ</div>
        <p style="color: var(--text-muted); margin: 0;">
          No visualizations generated yet. They will appear here after analysis.
        </p>
      </div>
      {% endif %}
    </div>

    <!-- Action Buttons -->
    <div class="back">
      <a href="{{ url_for('upload_file') }}" class="btn primary" style="font-size: 1.125rem; padding: 1rem 2rem;">
        <span>ğŸ“¤</span>
        <span>Analyze Another File</span>
      </a>
    </div>

    <!-- Footer -->
    <footer>
      <small>
        ğŸ’¡ <strong>Tip:</strong> All visualizations are saved to <code>static/plots/</code> â€¢
        ğŸ”„ Analysis includes data cleaning (null removal & deduplication) â€¢
        ğŸ¤– Powered by scikit-learn ML algorithms
      </small>
    </footer>
  </div>

  <!-- Animation and interaction scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Animated counr stats
      const statValues = document.querySelectorAll('.stat-card .value[data-count]');

      statValues.forEach(stat => {
        const target = parseInt(stat.getAttribute('data-count'));
        const duration = 2000; // 2 s       const increment = target / (duration / 16); // 60fps
        let current = 0;

        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            stat.textContent = target.toLocaleString();
            clearInterval(timer);
          } else {
            stat.textContent = Math.floor(current).toLocaleString();
          }
        }, 16);
      });

      // Stagger animation for plot cards  
      const plotCards = document.querySelectorAll('.plot-card');
      plotCards.forEach((card, index) => {
        card.style.animationDelay = `${0.1 * index}s`;
      });

      // Add smooth scroll to sections
      const headers = document.querySelectorAll('h2');
      headers.forEach(header => {
        header.style.cursor = 'pointer';
        header.addEventListener('click', function () {
          this.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      // Image lazy loading fallback
      if ('loading' in HTMLImageElement.prototype) {
        const images = document.querySelectorAll('img[loading="lazy"]');
        images.forEach(img => {
          img.src = img.src;
        });
      }

      // Add entrance animation to tables
      const tables = document.querySelectorAll('.table-wrapper');
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      tables.forEach(table => {
        table.style.opacity = '0';
        table.style.transform = 'translateY(20px)';
        table.styleran = 'all 0.6s ease-out';
        observer.observe(table);
      });
    });

    // Clear plots when page closes or navigates away
    window.addEventListener('beforeunload', function() {
      navigator.sendBeacon('/clear-plots', new Blob([''], {type: 'application/json'}));
    });

    // Clear plots when user navigates to upload page
    document.addEventListener('DOMContentLoaded', function() {
      const uploadLink = document.querySelector('a[href="/"]');
      if (uploadLink) {
        uploadLink.addEventListener('click', function(e) {
          fetch('/clear-plots', { method: 'POST' });
        });
      }
    });
  </script>
</body>

</html>